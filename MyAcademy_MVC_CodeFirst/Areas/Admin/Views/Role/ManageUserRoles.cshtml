@using MyAcademy_MVC_CodeFirst.Areas.Admin.Models
@model List<UserRolesViewModel>

@{
    ViewBag.Title = "Kullanıcı Yönetimi";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid p-4">
    <div class="d-flex align-items-center mb-4">
        <h1 class="h4 mb-0 fw-bold text-dark">Kullanıcı Yönetimi</h1>
        <span class="badge bg-primary ms-3 shadow-sm">@Model.Count Toplam Kullanıcı</span>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show d-flex align-items-center border-0 shadow-sm mb-4" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <div>@TempData["Success"]</div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (Model.Count == 0)
    {
        <div class="card border-0 shadow-sm text-center py-5">
            <div class="card-body">
                <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                <p class="text-muted h5">Henüz kullanıcı oluşturulmamış</p>
                <a href="@Url.Action("CreateUser", "Role")" class="btn btn-success mt-3">
                    <i class="fas fa-plus me-1"></i> İlk Kullanıcıyı Ekle
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="card shadow-sm border-0 overflow-hidden">
            <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                <h6 class="mb-0 fw-bold text-muted text-uppercase small" style="letter-spacing: 1px;">Kullanıcı Listesi</h6>
                <a href="@Url.Action("CreateUser", "Role")" class="btn btn-success btn-sm px-3 shadow-sm d-flex align-items-center gap-2">
                    <i class="fas fa-plus"></i>
                    <span>Yeni Kullanıcı Ekle</span>
                </a>
            </div>

            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="bg-light">
                        <tr>
                            <th class="fw-semibold px-4 py-3 border-0">Kullanıcı Bilgileri</th>
                            <th class="fw-semibold py-3 border-0">E-posta</th>
                            <th class="fw-semibold py-3 border-0">Roller</th>
                            <th class="fw-semibold text-end px-4 py-3 border-0">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model)
                        {
                            <tr>
                                <td class="px-4 py-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-primary bg-opacity-10 p-2 rounded-circle">
                                            <i class="fas fa-user text-primary" style="font-size: 1.1rem;"></i>
                                        </div>
                                        <div>
                                            <p class="mb-0 fw-bold text-dark">@user.UserName</p>
                                            <small class="text-muted small">ID: @user.UserId.Substring(0, 8)...</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="py-3">
                                    <a href="mailto:@user.UserEmail" class="text-decoration-none text-muted small">
                                        <i class="far fa-envelope me-1"></i> @user.UserEmail
                                    </a>
                                </td>
                                <td class="py-3">
                                    @if (user.SelectedRoles != null && user.SelectedRoles.Any())
                                    {
                                        foreach (var role in user.SelectedRoles)
                                        {
                                            var badgeClass = role == "Admin" ? "bg-danger" : "bg-info";
                                            <span class="badge @badgeClass text-white fw-normal shadow-none" style="font-size: 0.7rem;">@role</span>
                                        }
                                    }
                                    else
                                    {
                                        <span class="badge bg-light text-muted fw-normal border" style="font-size: 0.7rem;">Rol Yok</span>
                                    }
                                </td>
                                <td class="text-end px-4 py-3">
                                    <div class="btn-group shadow-sm border rounded bg-white">
                                        <a href="/Admin/Role/UpdateUser/@user.UserId"
                                           class="btn btn-link btn-sm text-decoration-none border-end px-3"
                                           title="Bilgileri Güncelle">
                                            <i class="fas fa-user-edit text-warning"></i>
                                        </a>
                                        <a href="/Admin/Role/EditUserRoles?userId=@user.UserId"
                                           class="btn btn-link btn-sm text-decoration-none border-end px-3"
                                           title="Rolleri Yönet">
                                            <i class="fas fa-shield-alt text-primary"></i>
                                        </a>
                                        <a href="/Admin/Role/DeleteUser/@user.UserId"
                                           class="btn btn-link btn-sm text-decoration-none px-3"
                                           title="Kullanıcıyı Sil"
                                           onclick="return confirm('@user.UserName kullanıcısını tamamen silmek istediğinize emin misiniz?')">
                                            <i class="fas fa-trash-alt text-danger"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

<style>
    .table thead th {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        color: #6c757d;
    }

    .table tbody tr {
        transition: all 0.2s ease;
    }

        .table tbody tr:hover {
            background-color: #fbfcfe !important;
        }

    .btn-group .btn-link {
        padding: 0.5rem 0.8rem;
        background: transparent;
    }

        .btn-group .btn-link:hover {
            background-color: #f8f9fa;
        }

    .badge {
        padding: 0.45em 0.85em;
        border-radius: 6px;
    }

    .card {
        border-radius: 12px;
    }
</style>